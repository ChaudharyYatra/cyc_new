



</div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
 

    <div class="float-right d-none d-sm-block">
      <!--<b>Version</b> 3.2.0-->
    </div>
    <center><strong>Copyright &copy; <?php echo date("Y"); ?>.</strong> All rights reserved.</center>
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->


<!-- jQuery -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 4 -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/jquery-validation/jquery.validate.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/jquery-validation/additional-methods.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/summernote/summernote-bs4.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/codemirror/codemirror.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/codemirror/mode/css/css.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/codemirror/mode/xml/xml.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/codemirror/mode/htmlmixed/htmlmixed.js"></script>

<script src="<?php echo base_url(); ?>assets/admin/plugins/select2/js/select2.full.min.js"></script>
<!-- Bootstrap4 Duallistbox -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>
<!-- InputMask -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/moment/moment.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/inputmask/jquery.inputmask.min.js"></script>
<!-- date-range-picker -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/daterangepicker/daterangepicker.js"></script>
<!-- bootstrap color picker -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Bootstrap Switch -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/bootstrap-switch/js/bootstrap-switch.min.js"></script>
<!-- BS-Stepper -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/bs-stepper/js/bs-stepper.min.js"></script>
<!-- dropzonejs -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/dropzone/min/dropzone.min.js"></script>
<!-- AdminLTE App -->
<script src="<?php echo base_url(); ?>assets/admin/dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="<?php echo base_url(); ?>assets/admin/dist/js/demo.js"></script>

<!-- Page specific script -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/select2/js/select2.full.min.js"></script>

<!-- Summernote -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/summernote/summernote-bs4.min.js"></script>
<!-- CodeMirror -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/codemirror/codemirror.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/codemirror/mode/css/css.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/codemirror/mode/xml/xml.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/codemirror/mode/htmlmixed/htmlmixed.js"></script>


<!-- date-range-picker -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/daterangepicker/daterangepicker.js"></script>
<!-- bootstrap color picker -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Bootstrap Switch -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/bootstrap-switch/js/bootstrap-switch.min.js"></script>
<!-- BS-Stepper -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/bs-stepper/js/bs-stepper.min.js"></script>
<!-- dropzonejs -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/dropzone/min/dropzone.min.js"></script>



<script src="<?php echo base_url(); ?>assets/admin/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>
<!-- InputMask -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/moment/moment.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/inputmask/jquery.inputmask.min.js"></script>

<!-- DataTables  & Plugins -->
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/jszip/jszip.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/pdfmake/pdfmake.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/pdfmake/vfs_fonts.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables-buttons/js/buttons.print.min.js"></script>
<script src="<?php echo base_url(); ?>assets/admin/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>

<script>
  $(function () {
    $("#example1").DataTable({
      "responsive": true, "lengthChange": false, "autoWidth": false,
      "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
    }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
    $('#example2').DataTable({
      "paging": true,
      "lengthChange": false,
      "searching": false,
      "ordering": true,
      "info": true,
      "autoWidth": false,
      "responsive": true,
    });
  });
</script>

<!-- <script>
        $(document).on('click', '.newid', function(){  
        var button_id = $(this).attr("attr_hold");   
      //  $('#new_row'+button_id).remove();  
      alert(button_id);
      });
</script> -->

<!-- tour opration manager fotter -->

<!-- suggestion in that package type wise package name display dependency start -->
<script type='text/javascript'>
  // baseURL variable
  var baseURL= "<?php echo base_url();?>";
 
  $(document).ready(function(){
 
    // district change
    $('#package_type').change(function(){
      var did = $(this).val();
    //   alert(did); 
      // AJAX request
      $.ajax({
        url:'<?=base_url()?>tour_operation_manager/hotel_advance_payment/get_package',
        method: 'post',
        data: {did: did},
        dataType: 'json',
        success: function(response){
        console.log(response);
        
          $('#tour_number').find('option').not(':first').remove();
       
          $.each(response,function(index,data){       
             $('#tour_number').append('<option value="'+data['id']+'">'+data['tour_number']+' - '+data['tour_title']+'</option>');
          });
         
        }
     });
   });
 });
</script>

<script type='text/javascript'>
  // baseURL variable
  var baseURL= "<?php echo base_url();?>";
 
  $(document).ready(function(){
 
    // district change
    $('#tour_number').change(function(){
      var did = $(this).val();
    //   alert(did); 
      // AJAX request
      $.ajax({
        url:'<?=base_url()?>tour_operation_manager/hotel_advance_payment/get_hotel',
        method: 'post',
        data: {did: did},
        dataType: 'json',
        success: function(response){
        console.log(response);
        
          $('#hotel_name').find('option').not(':first').remove();
       
          $.each(response,function(index,data){       
             $('#hotel_name').append('<option value="'+data['id']+'">'+data['hotel_name']+'</option>');
          });
         
        }
     });
   });
 });
</script>
<!------ suggestion in that package type wise package name display dependency start ---->

<!-- jquery validation on add tour_operation_manager assign staff -->
<script>
$(document).ready(function () {

$('#add_assign_staff').validate({ // initialize the plugin
    errorPlacement: function($error, $element) {
    $error.appendTo($element.closest("div"));
  },
    rules: {
        package_type: {
            required: true,
        },
        tour_number: {
            required: true,
        },
        "role_name[]": {
            required: true,
        },
        "name[]": {
            required: true,
        }
        // email: {
        //     required: true,
        // },
        // gender: {
        //     required: true,
        // },
        // image_name: {
        //     required: true,
        // },
        
    },

    messages :{
        package_type : {
            required : "Please Select package type",
        },
        tour_number : {
            required : "Please select tour name",
        },
        "role_name[]" : {
            required : "Please select role name",
        },
        "name[]" : {
            required : "Please select name",
        }
        // email : {
        //     required : "Please enter email",
        // },
        // gender : {
        //     required : "Please select gender",
        // },
        // image_name : {
        //     required : "Please upload image",
        // },
    
    }
});

});

</script>

<script>
$(document).ready(function () {

$('#edit_assign_staff').validate({ // initialize the plugin
    errorPlacement: function($error, $element) {
    $error.appendTo($element.closest("div"));
  },
    rules: {
        package_type: {
            required: true,
        },
        tour_number: {
            required: true,
        },
        "role_name[]": {
            required: true,
        },
        "name[]": {
            required: true,
        }
        
    },

    messages :{
        package_type : {
            required : "Please Select package type",
        },
        tour_number : {
            required : "Please select tour name",
        },
        "role_name[]" : {
            required : "Please select role name",
        },
        "name[]" : {
            required : "Please select name",
        }
    
    }
});

});

</script>
<!-- end jquery validation on add tour_operation_manager assign staff -->

<script type='text/javascript'>
  // baseURL variable
  var baseURL= "<?php echo base_url();?>";
 
  $(document).ready(function(){
 
    $(document).on("change","select", function () {

        var did = $(this).val();
        var select_type = $(this).attr('attr_name');
        var currentRow = $(this).closest(".row");
        // console.log(currentRow.find(".name"));
        // var col3=currentRow.find("td:eq(2)").text(); 
if(select_type=='role'){

      // AJAX request
      $.ajax({
        url:'<?=base_url()?>tour_operation_manager/assign_staff/getrolename', 
        method: 'post',
        data: {did: did},
        dataType: 'json',
        success: function(response){
        // console.log(response);
        
        //   $('.name').find('option').not(':first').remove();
        currentRow.find(".name").find('option').not(':first').remove();
       
        if(did!= '9'){
          $.each(response,function(index,data){             
            currentRow.find(".name").append('<option value="'+data['id']+'">'+data['supervision_name']+'</option>');
            //  $('.name').append('<option value="'+data['id']+'">'+data['supervision_name']+'</option>');
          });
        }
        else{
          $.each(response,function(index,data){             
            currentRow.find(".name").append('<option value="'+data['id']+'">'+data['vehicle_owner_name']+'</option>');
            //  $('.name').append('<option value="'+data['id']+'">'+data['supervision_name']+'</option>');
        });
        }
      }
     });
    }
   });
 });
 </script>

<script>

var i=1;
$('#add_more_staff').click(function() {
   // alert('hhhh');
        
var structure = $(` <div class="row" id="new_row`+i+`">
                        <div class="col-md-5">
                        <div class="form-group">
                            <label>Select role </label>
                            <select class="select_css role_name" attr_name="role" name="role_name[]" id="role_name`+i+`" required="required">
                            <option value="">select role</option>
                            <?php
                                foreach($role_type as $role_type_info){ 
                            ?>
                            <option value="<?php echo $role_type_info['id']; ?>"><?php echo $role_type_info['role_name']; ?></option>
                            <?php } ?>
                            
                            </select>
                        </div>
                        </div>

                        <div class="col-md-6">
                        <div class="form-group">
                            <label>Name </label>
                            <select class="select_css row_set1 name" attr_name="staff_name" name="name[]" id="name`+i+`" required="required">
                            <option value="">select name</option>
                            
                            </select>
                        </div>
                        </div>

                        <div class="col-md-1 mt-4 d-flex justify-content-center align-self-center">
                            <div class="form-group">
                            <label></label>
                                <button type="button" name="remove" id="`+i+`" class="btn btn-danger btn_remove">X</button>
                            </div>
                        </div>

                        <input type="hidden" class="form-control" name="package_id[]" id="package_id" value="<?php echo $pid ?>">
                        <input type="hidden" class="form-control" name="package_date_id[]" id="package_date_id" value="<?php echo $id ?>">

                    </div>
              `);
$('#main_row').append(structure); 
i++;
});


$(document).on('click', '.btn_remove', function(){  
       var button_id = $(this).attr("id");   
       $('#new_row'+button_id+'').remove();  
  });

</script>


<!-- approve expenses -->

<script>  
 $(document).ready(function(){
  $(".approve").click(function() {   
    // alert('hii');
    var did = $('#expense_id').val();
    // alert(did);
          var attr_approve =$(this).attr('attr_approve');
        //    alert(attr_approve);

           
           if(attr_approve != '' && did != '')  
           {  
                $.ajax({  
                     url:"<?php echo base_url(); ?>tour_operation_manager/completed_tours/get_approve",  
                     method:"post",  
                     data:{attr_approve:attr_approve , did:did},  
                     dataType: 'json',
                     success:function(responce){ 
                      // alert('alert done');
                         if(responce = 'true')
                         {
                          console.log('now done'); 
                              // alert(responce);
                          // redirect($this->module_url_path.'agent/booking_enquiry/index');
                          window.location.href = "<?=base_url()?>tour_operation_manager/completed_tours/expenses/"+did;
                         }
                     }  
                });  
           } 
          }); 
      });  
 </script>

 <!-- reject expenses -->

<script>  
 $(document).ready(function(){
  $(".reject").click(function() {   
    // alert('hii');
    var did = $('#expense_id').val();
    // alert(did);
          var attr_reject =$(this).attr('attr_reject');
        //    alert(attr_reject);

           
           if(attr_reject != '' && did != '')  
           {  
                $.ajax({  
                     url:"<?php echo base_url(); ?>tour_operation_manager/completed_tours/get_reject",  
                     method:"post",  
                     data:{attr_reject:attr_reject , did:did},  
                     dataType: 'json',
                     success:function(responce){ 
                      // alert('alert done');
                         if(responce = 'true')
                         {
                          console.log('now done'); 
                              // alert(responce);
                          // redirect($this->module_url_path.'agent/booking_enquiry/index');
                          window.location.href = "<?=base_url()?>tour_operation_manager/completed_tours/expenses/"+did;
                         }
                     }  
                });  
           } 
          }); 
      });  
 </script>

 <!-- ---------change bus ajax ----------------------------------------------->
 <script type='text/javascript'>
  // baseURL variable
  var baseURL= "<?php echo base_url();?>";
 
  $(document).ready(function(){
 
    // district change
    $('#vehicle_owner_name').change(function(){
      var did = $(this).val();
      // var seat = $('#seat_no').val();
      // alert(seat); 
      // AJAX request
      $.ajax({
        url:'<?=base_url()?>tour_operation_manager/change_bus/get_change_bus',
        method: 'post',
        data: {did: did},
        dataType: 'json',
        success: function(response){
        console.log(response);
        // alert(response);
          $('#rto_no').find('option').not(':first').remove();
       
          $.each(response,function(index,data){       
             $('#rto_no').append('<option value="'+data['id']+'">'+data['registration_number']+'</option>');
          });
         
        }
     });
   });
 });
</script>
<!-- ---------change bus ajax --------------------------------------------->

<!-- ---------change bus seat capacity ajax ----------------------------------------------->
<script type='text/javascript'>
  // baseURL variable
  var baseURL= "<?php echo base_url();?>";
 
  $(document).ready(function(){
 
    // district change
    $('#rto_no').change(function(){
      var did = $(this).val();
      // var seat = $('#seat_no').val();
      // alert(did); 
      // AJAX request
      $.ajax({
        url:'<?=base_url()?>tour_operation_manager/change_bus/get_change_bus_seat',
        method: 'post',
        data: {did: did},
        dataType: 'json',
        success: function(response){
        console.log(response);
        // alert(response);
          $('#seat_capacity').find('option').not(':first').remove();
       
          $.each(response,function(index,data){       
            $('#seat_capacity').val(data['seat_capacity']);
          });
         
        }
     });
   });
 });
</script>
<!-- ---------change bus seat capacity ajax --------------------------------------------->

<script>
$(document).ready(function () {

$('#tour_operation_change_password').validate({ // initialize the plugin
    errorPlacement: function($error, $element) {
    $error.appendTo($element.closest("div"));
  },
    rules: {
     old_pass: {
            required: true,
        },
        new_password: {
            required: true,
            // minlength: 6,
			notEqualTo:"#old_pass",
            pattern: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@#$!%*?&])[A-Za-z\d@#$!%*?&]{6,15}$/
        },
        confirm_pass: {
            required: true,
            equalTo: "#new_password", 
            // minlength: 6
        }
    },

    messages :{
     old_pass : {
            required : "Please enter old password",
        },
        new_password : {
            required : "Please enter new password",
            // minlength : "Please enter 6 digit or character length",
			notEqualTo : "New password and Old Password Same",
            pattern: " Password must contain: " +
                     "At least one upper case letter, " +
                     "At least one lower case letter, " +
                     "At least one number, " +
                     "At least one special character " +
                     "and be between 6-15 characters."
        },
        confirm_pass : {
            required : "Please enter confirm password",
            equalTo : "New password and Confirm Password can't match"
            // minlength : "Please enter 6 digit or character length"
        }
    
    }
});

});

</script>

<!-- new -->

<!-- tour manager module suugestion mosule validation -->
<script>
$(document).ready(function () {
$('#add_tour_expenses').validate({ // initialize the plugin
    errorPlacement: function($error, $element) {
    $error.appendTo($element.closest("div,td"));
  },
    rules: {
        expense_place: {
            required: true,
        },
        tour_expenses_type: {
            required: true,
        },
        bill_number: {
            required: true,
        },
        bill_date: {
            required: true,
        },
        total_pax: {
            required: true,
        },
        expense_type: {
            required: true,
        },
        expense_category: {
            required: true,
        },
        expense_amt: {
            required: true,
        },
        expense_date: {
            required: true,
        },
        image_name: {
            required: true,
        },
        pax_type: {
            required: true,
        },
        other_expense_category: {
            required : function(element) {
                var action = $("#expense_category").val();
                if(action == "Other") { 
                    return true;
                } else {
                    return false;
                }
            }    
        }
    },

    messages :{
        expense_place : {
            required : "Please Enter Expense place",
        },
        tour_expenses_type : {
            required : "Please Select Expense type",
        },
        bill_number : {
            required : "Please Enter Bill Number",
        },
        bill_date : {
            required : "Please Select Bill Date",
        },
        total_pax : {
            required : "Please Select Total Pax",
        },
        expense_type : {
            required : "Please Select Expense Type",
        },
        expense_category : {
            required : "Please Select Expense Category",
        },
        expense_amt : {
            required : "Please Enter Expense Amount",
        },
        expense_date : {
            required : "Please Enter Expense Date",
        },
        image_name : {
            required : "Please Select Image Name",
        },
        pax_type : {
            required : "Please Select Pax Type",
        },
        other_expense_category : {
            required : "Please Enter Other Sub-Expenses Head",
        }
    }
});

$('[name^="expense_type_row"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select expense head",
                // minlength: "Enter at least {0} characters",
            }
        })
    });
    
    $('[name^="expense_category_row"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select sub expense head",
                // minlength: "Enter at least {0} characters",
            }
        })
    });
    $('[name^="product_name"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select product name",
                // minlength: "Enter at least {0} characters",
            }
        })
    });

    $('[name^="measuring_unit"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select unit",
                // minlength: "Enter at least {0} characters",
            }
        })
    });

    $('[name^="quantity"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Enter quantity",
                // minlength: "Enter at least {0} characters",
            }
        })
    });

    $('[name^="rate"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Enter rate",
                // minlength: "Enter at least {0} characters",
            }
        })
    });
});

</script>

<script>
$(document).ready(function () {
$('#edit_tour_expenses').validate({ // initialize the plugin
    errorPlacement: function($error, $element) {
    $error.appendTo($element.closest("div,td"));
  },
  rules: {
        expense_place: {
            required: true,
        },
        bill_number: {
            required: true,
        },
        total_pax: {
            required: true,
        },
        expense_type: {
            required: true,
        },
        expense_category: {
            required: true,
        },
        expense_amt: {
            required: true,
        },
        expense_date: {
            required: true,
        },
        pax_type: {
            required: true,
        }
    },

    messages :{
        expense_place : {
            required : "Please Enter Expense place",
        },
        bill_number : {
            required : "Please Enter Bill Number",
        },
        total_pax : {
            required : "Please Select Total Pax",
        },
        expense_type : {
            required : "Please Select Expense Type",
        },
        expense_category : {
            required : "Please Select Expense Category",
        },
        expense_amt : {
            required : "Please Enter Expense Amount",
        },
        expense_date : {
            required : "Please Enter Expense Date",
        },
        pax_type : {
            required : "Select Enter Pax Type",
        }
    }
});

$('[name^="expense_type_row"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select expense head",
                // minlength: "Enter at least {0} characters",
            }
        })
    });

    $('[name^="expense_type_row"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select expense head",
                // minlength: "Enter at least {0} characters",
            }
        })
    });

    
    $('[name^="expense_category_row"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select sub expense head",
                // minlength: "Enter at least {0} characters",
            }
        })
    });
    $('[name^="product_name"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select product name",
                // minlength: "Enter at least {0} characters",
            }
        })
    });

    $('[name^="measuring_unit"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Select unit",
                // minlength: "Enter at least {0} characters",
            }
        })
    });

    $('[name^="quantity"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Enter quantity",
                // minlength: "Enter at least {0} characters",
            }
        })
    });

    $('[name^="rate"]').each(function() {
        // alert("cccccc");
        $(this).rules('add', {
            required: true,
            // minlength: 2,
            messages: {
                required: "Enter rate",
                // minlength: "Enter at least {0} characters",
            }
        })
    });


    // $('.dynamic-row').find('[name^="add_expense_type_row"]').rules('add', {
    //     required: true,
    //     messages: {
    //         required: "Select expense head",
    //     }
    // });

});

</script>
<!-- tour manager module suugestion mosule validation -->

<script type='text/javascript'>
  // baseURL variable
  var baseURL= "<?php echo base_url();?>";
 
  $(document).ready(function(){
 
    // district change
    $('#expense_type').change(function(){
      var did = $(this).val();
    //   alert(did); 
      // AJAX request
      $.ajax({
        url:'<?=base_url()?>expences_add_master/tour_expenses/get_category',
        method: 'post',
        data: {did: did},
        dataType: 'json',
        success: function(response){
        console.log(response);
        
          $('#expense_category').find('option').not(':first').remove();
       
          $.each(response,function(index,data){   

             $('#expense_category').append('<option value="'+data['id']+'">'+data['expense_category']+'</option>');
          });
          $('#expense_category').append('<option value="Other">Other</option>');
        }
     });
   });
 });
</script>

<script>
    $(document).ready(function() {

        $("#table").on("change", ".expense_type", function() {
        var did = $(this).val();
        var $currentRow = $(this).closest("tr");

        // Make an Ajax request to fetch sub-expense categories
        $.ajax({
            url: '<?= base_url() ?>expences_add_master/tour_expenses/get_category',
            method: 'POST',
            data: { did: did },
            dataType: 'json',
            success: function(response) {
                // Find the "Sub-Expenses Head" dropdown in the current row
                var $expenseCategoryDropdown = $currentRow.find('.sub_expenses_head');

                // Clear the existing options
                $expenseCategoryDropdown.empty();

                // Add the new options
                $expenseCategoryDropdown.append('<option value="">Select </option>');
                $.each(response, function(index, data) {
                    $expenseCategoryDropdown.append('<option value="' + data['id'] + '">' + data['expense_category'] + '</option>');
                });
                $expenseCategoryDropdown.append('<option value="Other_row">Other</option>');
            }
        });
    });

    $("#table").on("change", ".sub_expenses_head", function() {
        var selectedOption = $(this).val();
        var $otherInput = $(this).closest("tr").find(".other-input");

        if (selectedOption === "Other_row") {
            $otherInput.show();
            $otherInput.find("input").prop("required", true);
        } else {
            $otherInput.hide();
            $otherInput.find("input").prop("required", false);
        }
    });

        // Function to update per_unit_rate field for a specific row
        function updatePerUnitRate(row) {
            var quantity = parseFloat($(row).find(".quantity").val());
            var rate = parseFloat($(row).find(".rate").val());

            if (!isNaN(quantity) && !isNaN(rate) && quantity !== 0) {
                var perUnitRate = rate / quantity;
                $(row).find(".per_unit_rate").val(perUnitRate.toFixed(2)); // You can adjust the number of decimal places as needed.
            } else {
                $(row).find(".per_unit_rate").val('');
            }
        }

        // Function to update expense_amt field
        function updateExpenseAmount() {
            var totalRate = 0;
            $(".rate").each(function() {
                var rate = parseFloat($(this).val());
                if (!isNaN(rate)) {
                    totalRate += rate;
                }
            });

            $("#expense_amt").val(totalRate.toFixed(2)); // You can adjust the number of decimal places as needed.
        }

        // Add more rows when the "Add More" button is clicked
        
        $("#expenses_add_more").click(function() {
            var expence = $(this).attr('attr_add_id');
            
            var i= parseInt(expence)+parseInt(1);
            // alert(i);
            var expence = $(this).attr('attr_add_id',i);
            var newRow = `
                <tr>
                    <td>
                        <select class="select_css expense_type" name="expense_type_row[]" id="expense_type_row`+i+`">
                            <option value="">Select </option>
                            <?php foreach($expense_type_data as $expense_type_info){ ?> 
                                <option value="<?php echo $expense_type_info['id'];?>"><?php echo $expense_type_info['expense_type_name'];?></option>
                            <?php } ?>
                        </select>
                    </td>
                    <td>
                        <select class="select_css sub_expenses_head" name="expense_category_row[]" id="expense_category_row`+i+`">
                                <option value="">Select </option>
                                
                        </select>
                        <br>
                        <input style="display: none;margin-top: 8px;" type="text" class="form-control other-input" name="other_name[]" id="other_name`+i+`" placeholder="Enter name" >
                    </td>
                    
                    <td>
                        <select class="select_css" name="product_name[]" id="product_name`+i+`">
                            <option value="">Select </option>
                            <?php foreach($expense_category as $expense_category_info){ ?>
                                '<option value="<?php echo $expense_category_info['id'];?>"><?php echo $expense_category_info['expense_category'];?></option>'+
                            <?php } ?>
                        </select>
                    </td>
                    <td>
                        <select class="select_css" name="measuring_unit[]" id="measuring_unit`+i+`" >
                            <option value="">Select </option>
                            <?php foreach($measuring_unit as $measuring_unit_info){ ?> 
                                <option value="<?php echo $measuring_unit_info['id'];?>"><?php echo $measuring_unit_info['unit_type'];?></option>
                            <?php } ?>
                        </select>
                    </td>
                    <td><input type="text" class="form-control quantity" name="quantity[]" id="quantity`+i+`" placeholder="Enter quantity"></td>
                    <td><input type="text" class="form-control rate" name="rate[]" id="rate`+i+`" placeholder="Enter rate"></td>
                    <td><input readonly type="text" class="form-control per_unit_rate" id="per_unit_rate`+i+`" name="per_unit_rate[]" placeholder="Enter per unit rate"></td>
                    <td>
                        <button type="button" class="btn btn-danger remove-row">Remove</button>
                    </td>
                </tr>
            `;
            $("#table tbody").append(newRow);
            i++;
        });
        
        // Remove a row when the "Remove" button is clicked
        $(document).on("click", ".remove-row", function() {
            $(this).closest("tr").remove();
            updateExpenseAmount(); // Recalculate the total when a row is removed
        });

        // Update per_unit_rate when quantity or rate changes in any row
        $(document).on("input", ".quantity, .rate", function() {
            // Loop through all rows and update their per_unit_rate
            $("#table tbody tr").each(function() {
                updatePerUnitRate(this);
            });

            updateExpenseAmount(); // Recalculate the total when a rate or quantity changes
        });

        $(document).on("change", ".sub_expenses_head", function() {
            var selectedOption = $(this).val();
            var otherNameInput = $(this).closest("tr").find(".other-input");

            if (selectedOption === "Other_row") {
                otherNameInput.prop("required", true);
            } else {
                otherNameInput.prop("required", false);
            }
        });

    });
</script>

<script>
    $(document).ready(function() {

        $("#table").on("change", ".expense_type", function() {
        var did = $(this).val();
        var $currentRow = $(this).closest("tr");

        // Make an Ajax request to fetch sub-expense categories
        $.ajax({
            url: '<?= base_url() ?>expences_add_master/tour_expenses/get_category',
            method: 'POST',
            data: { did: did },
            dataType: 'json',
            success: function(response) {
                // Find the "Sub-Expenses Head" dropdown in the current row
                var $expenseCategoryDropdown = $currentRow.find('.sub_expenses_head');

                // Clear the existing options
                $expenseCategoryDropdown.empty();

                // Add the new options
                $expenseCategoryDropdown.append('<option value="">Select </option>');
                $.each(response, function(index, data) {
                    $expenseCategoryDropdown.append('<option value="' + data['id'] + '">' + data['expense_category'] + '</option>');
                });
                $expenseCategoryDropdown.append('<option value="Other_row">Other</option>');
            }
        });
    });

    $("#table").on("change", ".sub_expenses_head", function() {
        var selectedOption = $(this).val();
        var $otherInput = $(this).closest("tr").find(".other-input");

        if (selectedOption === "Other_row") {
            $otherInput.show();
            $otherInput.find("input").prop("required", true);
        } else {
            $otherInput.hide();
            $otherInput.find("input").prop("required", false);
        }
    });

        // Function to update per_unit_rate field for a specific row
        function updatePerUnitRate(row) {
            var quantity = parseFloat($(row).find(".quantity").val());
            var rate = parseFloat($(row).find(".rate").val());

            if (!isNaN(quantity) && !isNaN(rate) && quantity !== 0) {
                var perUnitRate = rate / quantity;
                $(row).find(".per_unit_rate").val(perUnitRate.toFixed(2)); // You can adjust the number of decimal places as needed.
            } else {
                $(row).find(".per_unit_rate").val('');
            }
        }

        // Function to update expense_amt field
        function updateExpenseAmount() {
            var totalRate = 0;
            $(".rate").each(function() {
                var rate = parseFloat($(this).val());
                if (!isNaN(rate)) {
                    totalRate += rate;
                }
            });

            $("#expense_amt").val(totalRate.toFixed(2)); // You can adjust the number of decimal places as needed.
        }

        // Add more rows when the "Add More" button is clicked
        var i=1;
        $("#expenses_edit_more").click(function() {

            // var expence = $(this).attr('attr_add_id');
            
            // var i= parseInt(expence)+parseInt(1);
            // // alert(i);
            // var expence = $(this).attr('attr_add_id',i);

           
            // alert(i);
            var newRow = `
                <tr>
                    <td>
                        <select class="select_css expense_type" name="add_expense_type_row[]" id="add_expense_type_row`+i+`">
                            <option value="">Select </option>
                            <?php foreach($expense_type_data as $expense_type_info){ ?> 
                                <option value="<?php echo $expense_type_info['id'];?>"><?php echo $expense_type_info['expense_type_name'];?></option>
                            <?php } ?>
                        </select>
                    </td>
                    <td>
                        <select class="select_css sub_expenses_head" name="add_expense_category_row[]" id="add_expense_category_row`+i+`">
                                <option value="">Select </option>
                                
                        </select>
                        <br>
                        <input style="display: none;margin-top: 8px;" type="text" class="form-control other-input" name="add_other_name[]" id="other_name`+i+`" placeholder="Enter name" >
                    </td>
                    <td>
                        <select class="select_css" name="add_product_name[]" id="add_product_name`+i+`" required>
                            <option value="">Select Product Name</option>
                            <?php foreach($expense_category as $expense_category_info){ ?>
                                '<option value="<?php echo $expense_category_info['id'];?>"><?php echo $expense_category_info['expense_category'];?></option>'+
                            <?php } ?>
                        </select>
                    </td>
                    <td>
                        <select class="select_css" name="add_measuring_unit[]" id="add_measuring_unit`+i+`" >
                            <option value="">Select </option>
                            <?php foreach($measuring_unit as $measuring_unit_info){ ?> 
                                <option value="<?php echo $measuring_unit_info['id'];?>"><?php echo $measuring_unit_info['unit_type'];?></option>
                            <?php } ?>
                        </select>
                    </td>
                    <td><input type="text" class="form-control quantity" name="add_quantity[]" id="add_quantity`+i+`" placeholder="Enter quantity" required></td>
                    <td><input type="text" class="form-control rate" name="add_rate[]" id="add_rate`+i+`" placeholder="Enter rate" required></td>
                    <td><input readonly type="text" class="form-control per_unit_rate" name="add_per_unit_rate[]" placeholder="Enter per unit rate"></td>
                    <td>
                        <button type="button" class="btn btn-danger remove-row">Remove</button>
                    </td>
                </tr>
            `;
            $("#table tbody").append(newRow);
            i++;
            initializeValidationForNewRow(i - 1);
        });


        function initializeValidationForNewRow(rowIndex) {
    // Define rules and messages for the newly added row
    $('#add_expense_type_row' + rowIndex).rules('add', {
        required: true,
        messages: {
            required: "Select expense head"
        }
    });

    $('#add_expense_category_row' + rowIndex).rules('add', {
        required: true,
        messages: {
            required: "Select sub expense head"
        }
    });

    $('#add_product_name' + rowIndex).rules('add', {
        required: true,
        messages: {
            required: "Select product name"
        }
    });

    $('#add_measuring_unit' + rowIndex).rules('add', {
        required: true,
        messages: {
            required: "Select unit"
        }
    });

    $('#add_quantity' + rowIndex).rules('add', {
        required: true,
        messages: {
            required: "Enter quantity"
        }
    });

    $('#add_rate' + rowIndex).rules('add', {
        required: true,
        messages: {
            required: "Enter rate"
        }
    });
}

// Call the initializeValidationForNewRow function for any existing rows
$(".dynamic-row").each(function (index) {
    initializeValidationForNewRow(index + 1);
});


        // Remove a row when the "Remove" button is clicked
        $(document).on("click", ".remove-row", function() {
            $(this).closest("tr").remove();
            updateExpenseAmount(); // Recalculate the total when a row is removed
        });

        // Update per_unit_rate when quantity or rate changes in any row
        $(document).on("input", ".quantity, .rate", function() {
            // Loop through all rows and update their per_unit_rate
            $("#table tbody tr").each(function() {
                updatePerUnitRate(this);
            });

            updateExpenseAmount(); // Recalculate the total when a rate or quantity changes
        });

        
        
    });
</script>